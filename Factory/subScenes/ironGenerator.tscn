[gd_scene load_steps=5 format=2]

[ext_resource path="res://assets/textures/ironGenerator.png" type="Texture" id=1]

[sub_resource type="GDScript" id=1]
script/source = "extends RigidBody2D


export(int) var ingotSpeed: int = 100
var id : int
var type : String = \"ironGenerator\"
var orientation: int = 2
var loadedIngot = preload(\"res://subScenes/ironIngot.tscn\")
var ingot
var pathDone : Vector2




#creates tha path for the created object to follow
func setPath():
	
	addPointToPath(\"Path2D\", Vector2(0,0))
	addPointToPath(\"Path2D\", Vector2(0,1))
	continuePath()
#	addPointToPath(\"Path2D\", Vector2(1,0))
#	print(global.findCell(Vector2(0,1) + global.tileMap.world_to_map(self.position)))
#	nextCellInPath = global.findCell(pathDone + global.tileMap.world_to_map(self.position))
#
#	if nextCellInPath != null:
#		continuePath()
#
#		if global.conveyorbeltsList.has(nextCellInPath.type):
#			print(\"theres a conveyor\")
#			pointToAdd = global.getNextRelativePlaceForPath(nextCellInPath.type)
#			print(pointToAdd)
#			addPointToPath(\"Path2D\",pointToAdd)
##			get_node(\"Path2D\").curve.add_point(pointToAdd)
	
	print(pathDone)

func continuePath():
	var nextCellInPath
	var pointToAdd : Vector2
	
	nextCellInPath = global.findCell(pathDone + global.tileMap.world_to_map(self.position))
	if nextCellInPath != null:
		if global.conveyorbeltsList.has(nextCellInPath.type):
			pointToAdd = global.getNextRelativePlaceForPath(nextCellInPath.type)
			addPointToPath(\"Path2D\",pointToAdd)
			continuePath()
	else:
		pass
	
	
	
	
func _ready():
	setPath()





func addPointToPath(nodePathToAddTo: String,vectorToAdd: Vector2):
	pathDone += vectorToAdd
	print(pathDone)
	get_node(nodePathToAddTo).curve.add_point(global.tileMap.map_to_world(pathDone) + Vector2(64,64))



# Called every frame. 'delta' is the elapsed time since the previous frame.
# warning-ignore:unused_argument
func _process(delta):
	#calls every x frames and creates an ingot
	if global.framesPassedSicnceStarted % 60 == 0:
		print(\"ingot created\")
		ingot = loadedIngot.instance()
		get_node(\"Path2D/PathFollow2D\").add_child(ingot)
		get_node(\"Path2D/PathFollow2D\").offset += ingotSpeed


	

#usesless funciton ready to delet theoreticly
func ingot_direction(orientation_loc):
	var Vect
	match orientation_loc:
		0: Vect = Vector2(0,-1)
		1: Vect = Vector2(1,0)
		2: Vect = Vector2(0,1)
		3: Vect = Vector2(-1,0)
		
	return Vect



"

[sub_resource type="RectangleShape2D" id=2]
extents = Vector2( 12.8, 64 )

[sub_resource type="Curve2D" id=3]
_data = {
"points": PoolVector2Array(  )
}

[node name="RigidBody2D" type="RigidBody2D"]
collision_layer = 0
collision_mask = 0
mode = 1
mass = 65535.0
gravity_scale = 0.0
script = SubResource( 1 )
ingotSpeed = 30

[node name="Sprite" type="Sprite" parent="."]
texture = ExtResource( 1 )
offset = Vector2( 64, 64 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2( 64, 64 )
scale = Vector2( 5, 1 )
shape = SubResource( 2 )

[node name="Path2D" type="Path2D" parent="."]
curve = SubResource( 3 )

[node name="PathFollow2D" type="PathFollow2D" parent="Path2D"]
rotate = false
